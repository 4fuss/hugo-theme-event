{{- partial "css.html" (dict "cssFile" "styles/partials/counter.css") }}

<script>
  const SECOND_IN_MILLISECONDS = 1000;
  const MINUTE_IN_MILLISECONDS = SECOND_IN_MILLISECONDS * 60;
  const HOUR_IN_MILLISECONDS = MINUTE_IN_MILLISECONDS * 60;
  const DAY_IN_MILLISECONDS = HOUR_IN_MILLISECONDS * 24;

  const end = new Date("{{ .targetDate }}");
  let timer;

  function renderCounter() {
    const countdownElement = document.getElementById("countdown");

    if (!countdownElement) {
      console.warn("Countdown element not found.");
      return;
    }

    const now = new Date();
    let distance = end - now;
    if (distance < 0) {
      distance = 0;
      clearInterval(timer);
    }

    const days = Math.floor(distance / DAY_IN_MILLISECONDS);
    const hours = Math.floor(
      (distance % DAY_IN_MILLISECONDS) / HOUR_IN_MILLISECONDS
    );
    const minutes = Math.floor(
      (distance % HOUR_IN_MILLISECONDS) / MINUTE_IN_MILLISECONDS
    );
    const seconds = Math.floor(
      (distance % MINUTE_IN_MILLISECONDS) / SECOND_IN_MILLISECONDS
    );

    const counterText = `
      ${days} {{ T "counter_days" }}
      ${hours} {{ T "counter_hours" }}
      ${minutes} {{ T "counter_minutes" }}
      ${seconds} {{ T "counter_seconds" }}
    `;
    countdownElement.innerHTML = counterText;
  }

  // Initial rendering of the counter after DOM is initialized.
  setTimeout(renderCounter);
  // Start the countdown.
  timer = setInterval(renderCounter, 1000);
</script>

<div id="countdown" style="font-family: monospace; font-size: x-large"></div>
