{{- define "main" }}
  <style>
    header.session-list,
    section.session-list {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    header.session-list {
      margin-bottom: 3.75rem;
    }

    section.session-list {
      background-color: var(--color-secondary);
      padding: 3.75rem 0;
    }

    section.session-list > article {
      margin-bottom: 3.75rem;
    }

    section.session-list > article > h1 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--color-primary);
    }
    section.session-list > article > h2 {
      font-size: 1.625rem;
      font-weight: 700;
    }
    section.session-list > article > h3 {
      font-size: 1.625rem;
      font-weight: 700;
    }
    section.session-list > article > menu {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    article.session-list-filters {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    article.session-list-filter {
      display: flex;
      flex-direction: column;
      gap: 1.875rem;
    }

    article.session-list-filter h2 {
      font-weight: 600;
      font-size: 1.125rem;
    }

    article.session-list-filter menu {
      all: unset;
      list-style: none;
      display: flex;
      gap: 1.875rem;
    }

    article.session-list-filter menu label {
      all: unset;
      cursor: pointer;
      padding: 0.75rem 1.75rem;
      gap: 0.625rem;
      border-radius: 0.375rem;
      border: 0.0625rem solid var(--color-primary);
      color: var(--color-primary);
      font-size: 1rem;
      font-weight: 500;
      -webkit-user-select: none;
      user-select: none;
    }

    input.day-filter,
    input.track-filter {
      display: none;
    }
  </style>

  {{- $sessionsGroupedByDay := .Pages.GroupByParamDate "date" "2006-01-02" "asc" }}
  {{- $sessionsGroupedByTrack := .Pages.GroupByParam "track" }}

  {{- range $index, $element := $sessionsGroupedByDay }}
    <style>
      /* Hide sessions of other days than the one currently selected. */
      [value="day-{{ $index }}"].day-filter:checked ~ section .session-list-day:not([data-day="{{ $index }}"]) {
        display: none;
      }
      /* Highlight label of currently selected day filter. */
      [value="day-{{ $index }}"].day-filter:checked ~ header [for="filter-day-{{ $index }}"] {
        background-color: var(--color-primary-lighter);
        color: white;
      }
    </style>
    <input
      name="filter-day"
      type="radio"
      class="day-filter"
      value="day-{{ $index }}"
      id="filter-day-{{ $index }}"
      {{- if eq $index 0 }}
        checked
      {{- end }}
    />
  {{- end }}

  {{- range $sessionsGroupedByTrack }}
    <style>
      /* Hide sessions of not selected tracks. */
      [value="track-{{ .Key }}"].track-filter:not(:checked) ~ section li[data-track="{{ .Key }}"] {
        display: none;
      }
      /* Highlight label of selected track filter. */
      [value="track-{{ .Key }}"].track-filter:checked ~ header [for="filter-track-{{ .Key }}"] {
        background-color: var(--color-primary-lighter);
        color: white;
      }
    </style>
    <input
      name="filter-track"
      type="checkbox"
      class="track-filter"
      value="track-{{ .Key }}"
      id="filter-track-{{ .Key }}"
      checked
    />
  {{- end }}


  <header class="session-list">
    <div class="theme-content">
      <h1 class="h1">{{ T "list_sessions_title" }}</h1>
      <article class="session-list-filters">
        {{- if gt ($sessionsGroupedByDay | len) 1 }}
          <article class="session-list-filter">
            <h2>{{ T "list_sessions_title_day_filter" }}</h2>
            <menu>
              {{- range $index, $element := $sessionsGroupedByDay }}
                <li>
                  <label for="filter-day-{{ $index }}">
                    {{ T "list_sessions_day" (add $index 1) }}
                  </label>
                </li>
              {{- end }}
            </menu>
          </article>
        {{- end }}

        {{- if gt ($sessionsGroupedByTrack | len) 1 }}
          <article class="session-list-filter">
            <h2>{{ T "list_sessions_title_track_filter" }}</h2>
            <menu>
              {{- range $sessionsGroupedByTrack }}
                <li>
                  <label for="filter-track-{{ .Key }}">
                    #{{ .Key | upper }}
                  </label>
                </li>
              {{- end }}
            </menu>
          </article>
        {{- end }}
      </article>
    </div>
  </header>

  <section class="session-list">
    {{- range $index, $element := $sessionsGroupedByDay }}
      <article class="theme-content session-list-day" data-day="{{- $index }}">
        <h1 class="h1">{{ T "list_sessions_day" (add $index 1) }}</h1>
        <h2>{{ .Key | time.Format ":date_long" }}</h2>
        {{- range .Pages.GroupByParamDate "startsAt" "2006-01-02T15:04:00" "asc" }}
          <h3>{{ .Key | time.Format ":time_short" }}</h3>
          <menu>
            {{- range .Pages }}
              {{- $page := . }}
              <li data-track="{{- .Params.track }}">
                {{- $transformedSpeakers := slice }}
                {{- range .Params.speakers }}
                  {{- $speakerAvatarResource := ($page.Resources.GetMatch (printf "avatar-%s.*" .id)) }}
                  {{- $transformedSpeakers = $transformedSpeakers | append (
                    dict
                    "name" .fullName
                    "avatarResource" $speakerAvatarResource
                    )
                  }}
                {{- end }}
                {{- partial "event-row.html" (
                  dict
                  "track" .Params.track
                  "title" .Title
                  "link" .RelPermalink
                  "speakers" $transformedSpeakers
                  "isServiceSession" .Params.isServiceSession
                  "room" .Params.room.name
                  )
                }}
              </li>
            {{- end }}
          </menu>
        {{- end }}
      </article>
    {{- end }}
  </section>

  {{- partial "sections/cta.html" (
    dict
    "eventbriteId" .Site.Params.themes.event.callToAction.eventbrite.eventId
    "ctaUrl" .Site.Params.themes.event.callToAction.other.url
    )
  }}
{{- end }}
